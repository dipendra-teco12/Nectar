<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Nectar | Log in</title>

    <!-- Google Font: Source Sans Pro -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- icheck bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/icheck-bootstrap/3.0.1/icheck-bootstrap.min.css"
    />

    <!-- Bootstrap 4 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css"
    />

    <!-- Theme style -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/3.2.0/css/adminlte.min.css"
    />
  </head>
  <body class="hold-transition login-page">
    <div class="login-box">
      <div class="card card-outline card-primary">
        <div class="card-header text-center">
          <a href="/admin/dashboard" class="h1"><b>Nectar</b></a>
        </div>
        <div class="card-body">
          <p class="login-box-msg">Sign in to start your session</p>

          <form id="login-form" method="POST" action="/login">
            <div class="input-group mb-3">
              <input
                type="email"
                class="form-control"
                placeholder="Email"
                name="email"
                required
              />
              <div class="input-group-append">
                <div class="input-group-text">
                  <span class="fas fa-envelope"></span>
                </div>
              </div>
            </div>
            <div class="input-group mb-3">
              <input
                type="password"
                class="form-control"
                placeholder="Password"
                name="password"
                required
              />
              <div class="input-group-append">
                <div class="input-group-text">
                  <span class="fas fa-lock"></span>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-8">
                <!-- optional "Remember me" or other inputs here -->
              </div>
              <div class="col-4">
                <button type="submit" class="btn btn-primary btn-block">
                  Sign in
                </button>
              </div>
            </div>
          </form>
          <div id="login-message" class="mt-3"></div>

          <p class="mb-1">
            <a href="/forgot-password">I forgot my password</a>
          </p>
          <p class="mb-0">
            <a href="/register" class="text-center"
              >Register a new membership</a
            >
          </p>
        </div>
      </div>
    </div>

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Bootstrap 4 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.bundle.min.js"></script>

    <!-- AdminLTE App -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/3.2.0/js/adminlte.min.js"></script>

    <script>
      $(document).ready(function () {
        $("#login-form").submit(function (event) {
          event.preventDefault(); // Prevent traditional form submission

          // Clear previous messages
          $("#login-message").removeClass().text("");

          const formData = {
            email: $('input[name="email"]').val(),
            password: $('input[name="password"]').val(),
          };

          $.ajax({
            type: "POST",
            url: "/api/auth/login", // must match your server endpoint
            data: JSON.stringify(formData),
            contentType: "application/json", // tell server it's JSON
            dataType: "json",
          })
            .done(function (res) {
              if (res.message && res.data) {
                $("#login-message")
                  .addClass("alert alert-success")
                  .text(res.message);
                // Redirect or update UI as needed:
                window.location.href = "/admin/dashboard";
              } else {
                $("#login-message").text(res.message || "Unexpected response.");
              }
            })
            .fail(function (jqXHR) {
              const errMsg =
                jqXHR.responseJSON && jqXHR.responseJSON.message
                  ? jqXHR.responseJSON.message
                  : "Server errorâ€”please try again.";
              $("#login-message").addClass("alert alert-danger").text(errMsg);
            });
        });
      });
    </script>
  </body>
</html>


